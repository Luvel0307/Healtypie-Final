(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{5656:function(e,a,s){Promise.resolve().then(s.bind(s,6949))},6949:function(e,a,s){"use strict";s.r(a),s.d(a,{default:function(){return M}});var t=s(5444),r=s(9300),i=s(8001),n=s(3485),l=s(8503);function o({activeTab:e,onTabChange:a}){let[s,o]=(0,r.useState)(!1),c=[{id:"evaluacion",label:"Nueva Evaluaci\xf3n"},{id:"historial",label:"Historial"},{id:"pacientes",label:"Pacientes"}];return(0,t.jsx)("header",{className:"sticky top-0 z-50 bg-white/95 backdrop-blur border-b border-border",children:(0,t.jsxs)("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between py-4",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)("div",{className:"relative w-12 h-12",children:(0,t.jsx)(i.default,{src:"/logo_colegio.png",alt:"Colegio M\xe9xico",fill:!0,className:"object-contain",priority:!0})}),(0,t.jsx)("div",{className:"bg-secondary/20 p-2 rounded-lg",children:(0,t.jsx)("div",{className:"relative w-8 h-8",children:(0,t.jsx)(i.default,{src:"/foot-icon.png",alt:"Pie sano",fill:!0,className:"object-contain"})})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-xl sm:text-2xl font-bold text-primary",children:"Sistema de Evaluaci\xf3n de Pie Diab\xe9tico"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"An\xe1lisis inteligente con l\xf3gica difusa"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"Desarrollado en colaboraci\xf3n con el Colegio M\xe9xico"})]})]}),(0,t.jsx)("button",{onClick:()=>o(!s),className:"md:hidden p-2 rounded-md hover:bg-muted",children:s?(0,t.jsx)(n.Z,{size:24}):(0,t.jsx)(l.Z,{size:24})})]}),(0,t.jsx)("nav",{className:"hidden md:flex space-x-1 pb-4",children:c.map(s=>(0,t.jsx)("button",{onClick:()=>a(s.id),className:`px-4 py-2 rounded-md font-medium transition-colors duration-200 ${e===s.id?"bg-primary text-primary-foreground":"text-muted-foreground hover:text-foreground hover:bg-muted"}`,children:s.label},s.id))}),s&&(0,t.jsx)("div",{className:"md:hidden pb-4",children:(0,t.jsx)("nav",{className:"flex flex-col space-y-2",children:c.map(s=>(0,t.jsx)("button",{onClick:()=>{a(s.id),o(!1)},className:`px-4 py-2 rounded-md font-medium text-left transition-colors duration-200 ${e===s.id?"bg-primary text-primary-foreground":"text-muted-foreground hover:text-foreground hover:bg-muted"}`,children:s.label},s.id))})})]})})}var c=s(9817),d=s(4693),m=s(9983),x=s(2492),u=s(5407),h=s(6771),g=s(8218),p=s(1585),v=s(3691),f=s(4805),j=s(3594);function b({onImageCapture:e,className:a=""}){let[s,l]=(0,r.useState)("select"),[o,d]=(0,r.useState)(null),[m,x]=(0,r.useState)(""),[u,h]=(0,r.useState)(!1),g=(0,r.useRef)(null),b=(0,r.useRef)(null),N=(0,r.useRef)(null),y=(0,r.useRef)(null),w=(0,r.useCallback)(async()=>{try{if(h(!0),!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw Error("API de c\xe1mara no disponible en este navegador");let e=null;try{e=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:1280,min:640},height:{ideal:720,min:480}}})}catch(a){console.log("Primer intento fall\xf3, probando configuraci\xf3n b\xe1sica...");try{e=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:1280},height:{ideal:720}}})}catch(a){console.log("Segundo intento fall\xf3, usando configuraci\xf3n m\xednima..."),e=await navigator.mediaDevices.getUserMedia({video:!0})}}e&&g.current&&(g.current.srcObject=e,y.current=e,l("camera"),p.A.success("C\xe1mara activada correctamente"))}catch(a){console.error("Error accessing camera:",a);let e="No se pudo acceder a la c\xe1mara. ";a instanceof Error&&("NotAllowedError"===a.name?e+="Permisos de c\xe1mara denegados. Por favor, permita el acceso a la c\xe1mara en su navegador.":"NotFoundError"===a.name?e+="No se encontr\xf3 una c\xe1mara en su dispositivo.":"NotSupportedError"===a.name?e+="Su navegador no soporta el acceso a la c\xe1mara.":e+=a.message),p.A.error(e+" Por favor, seleccione un archivo en su lugar."),l("select")}finally{h(!1)}},[]),E=(0,r.useCallback)(()=>{y.current&&(y.current.getTracks().forEach(e=>e.stop()),y.current=null),g.current&&(g.current.srcObject=null)},[]),C=(0,r.useCallback)(()=>{if(!g.current||!b.current)return;let e=g.current,a=b.current,s=a.getContext("2d");s&&(a.width=e.videoWidth,a.height=e.videoHeight,s.drawImage(e,0,0),a.toBlob(e=>{if(e){let a=new Date().toISOString().replace(/[:.]/g,"-"),s=new File([e],`captura_${a}.jpg`,{type:"image/jpeg"});d(s),x(URL.createObjectURL(s)),l("preview"),E()}},"image/jpeg",.9))},[E]),F=()=>{m&&URL.revokeObjectURL(m),d(null),x(""),l("select"),E()};return(0,t.jsxs)("div",{className:`space-y-4 ${a}`,children:["select"===s&&(0,t.jsxs)(c.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"text-center space-y-4",children:[(0,t.jsx)("p",{className:"text-muted-foreground",children:"Sube una imagen de la lesi\xf3n para an\xe1lisis"}),(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[(0,t.jsxs)("button",{onClick:w,disabled:u,className:"btn-primary flex items-center justify-center gap-2",children:[(0,t.jsx)(v.Z,{size:20}),u?"Iniciando c\xe1mara...":"Tomar Foto"]}),(0,t.jsxs)("button",{onClick:()=>N.current?.click(),className:"btn-secondary flex items-center justify-center gap-2",children:[(0,t.jsx)(f.Z,{size:20}),"Cargar Imagen"]})]}),(0,t.jsx)("input",{ref:N,type:"file",accept:"image/*",onChange:e=>{let a=e.target.files?.[0];if(a){if(!a.type.startsWith("image/")){p.A.error("Por favor seleccione un archivo de imagen v\xe1lido");return}if(a.size>10485760){p.A.error("El archivo es demasiado grande. M\xe1ximo 10MB");return}d(a),x(URL.createObjectURL(a)),l("preview")}},className:"hidden"})]}),"camera"===s&&(0,t.jsxs)(c.E.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"space-y-4",children:[(0,t.jsxs)("div",{className:"relative bg-black rounded-lg overflow-hidden",children:[(0,t.jsx)("video",{ref:g,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-auto max-h-96 object-cover"}),(0,t.jsx)("div",{className:"absolute inset-0 border-2 border-dashed border-white/50 m-4 rounded-lg pointer-events-none"})]}),(0,t.jsxs)("div",{className:"flex gap-3 justify-center",children:[(0,t.jsxs)("button",{onClick:C,className:"btn-primary flex items-center gap-2",children:[(0,t.jsx)(v.Z,{size:20}),"Capturar"]}),(0,t.jsxs)("button",{onClick:F,className:"btn-secondary flex items-center gap-2",children:[(0,t.jsx)(n.Z,{size:20}),"Cancelar"]})]})]}),"preview"===s&&m&&(0,t.jsxs)(c.E.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"space-y-4",children:[(0,t.jsx)("div",{className:"relative aspect-video bg-muted rounded-lg overflow-hidden",children:(0,t.jsx)(i.default,{src:m,alt:"Vista previa de la imagen capturada",fill:!0,className:"object-contain"})}),(0,t.jsxs)("div",{className:"flex gap-3 justify-center",children:[(0,t.jsxs)("button",{onClick:()=>{o&&(e(o),p.A.success("Imagen capturada correctamente"))},className:"btn-primary flex items-center gap-2",children:[(0,t.jsx)(v.Z,{size:20}),"Analizar Imagen"]}),(0,t.jsxs)("button",{onClick:F,className:"btn-secondary flex items-center gap-2",children:[(0,t.jsx)(j.Z,{size:20}),"Tomar Otra"]})]})]}),(0,t.jsx)("canvas",{ref:b,className:"hidden"})]})}var N=s(6124),y=s(362),w=s(7694);function E({riesgo:e,nivelRiesgo:a,semaforoColor:s,nombre:r,className:i=""}){let n=()=>{switch(s){case"verde":return"from-green-500 to-green-600";case"amarillo":return"from-yellow-500 to-yellow-600";case"rojo":return"from-red-500 to-red-600";default:return"from-gray-500 to-gray-600"}};return(0,t.jsxs)(c.E.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.3},className:`card-shadow rounded-lg border-2 p-6 ${(()=>{switch(s){case"verde":return"semaforo-verde";case"amarillo":return"semaforo-amarillo";case"rojo":return"semaforo-rojo";default:return"bg-muted text-muted-foreground"}})()} ${i}`,children:[(0,t.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,t.jsx)("div",{className:`rounded-full p-3 bg-gradient-to-r ${n()} text-white`,children:(()=>{switch(s){case"verde":return(0,t.jsx)(N.Z,{className:"w-8 h-8"});case"amarillo":return(0,t.jsx)(y.Z,{className:"w-8 h-8"});case"rojo":return(0,t.jsx)(w.Z,{className:"w-8 h-8"});default:return(0,t.jsx)(m.Z,{className:"w-8 h-8"})}})()}),(0,t.jsxs)("div",{className:"flex-1",children:[r&&(0,t.jsxs)("p",{className:"text-sm font-medium opacity-80 mb-1",children:["Paciente: ",r]}),(0,t.jsxs)("h3",{className:"text-xl font-bold",children:["Riesgo: ",a]}),(0,t.jsxs)(c.E.p,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.2},className:"text-lg font-semibold opacity-90",children:["Puntuaci\xf3n: ",e.toFixed(2)]})]}),(0,t.jsx)("div",{className:"text-right",children:(0,t.jsx)("div",{className:`w-6 h-6 rounded-full bg-gradient-to-r ${n()}`})})]}),(0,t.jsx)("div",{className:"mt-4 pt-4 border-t border-current/20",children:(0,t.jsxs)("p",{className:"text-sm opacity-75",children:["verde"===s&&"✓ Bajo riesgo - Contin\xfae con cuidados preventivos","amarillo"===s&&"⚠ Riesgo moderado - Monitoreo frecuente requerido","rojo"===s&&"⚡ Alto riesgo - Evaluaci\xf3n m\xe9dica inmediata necesaria"]})})]})}async function C(e){return new Promise(a=>{let s=document.createElement("canvas"),t=s.getContext("2d"),r=new Image;r.onload=()=>{if(s.width=r.width,s.height=r.height,!t){a(F());return}t.drawImage(r,0,0);try{let e=t.getImageData(0,0,s.width,s.height).data,r=0,i=0,n=0,l=0,o=[];for(let a=0;a<e.length;a+=4){let s=e[a],t=e[a+1],c=e[a+2];e[a+3]>0&&(r+=s,i+=t,n+=c,o.push(s),l++)}if(0===l){a(F());return}let c=r/l,d=i/l,m=n/l,x=o.reduce((e,a)=>e+Math.pow(a-c,2),0)/l,u=s.width*s.height/1e4;a({areaLesion:Number(u.toFixed(4)),desvEstR:Number(Math.sqrt(x).toFixed(2)),mediaR:Number(c.toFixed(2)),mediaG:Number(d.toFixed(2)),mediaB:Number(m.toFixed(2))})}catch(e){console.error("Error analyzing image:",e),a(F())}},r.onerror=()=>{a(F())},r.src=URL.createObjectURL(e)})}function F(){return{areaLesion:Number((5*Math.random()+.5).toFixed(4)),desvEstR:Number((80*Math.random()+20).toFixed(2)),mediaR:Number((100*Math.random()+100).toFixed(2)),mediaG:Number((100*Math.random()+100).toFixed(2)),mediaB:Number((100*Math.random()+100).toFixed(2))}}function S(){let[e,a]=(0,r.useState)({nombre:"",sensibilidad:0,tiempoEvolucion:0,controlGlucemico:5,secrecion:!1,eritema:!1}),[s,i]=(0,r.useState)(null),[n,l]=(0,r.useState)(null),[o,v]=(0,r.useState)(!1),[f,j]=(0,r.useState)(!1),N=(e,s)=>{a(a=>({...a,[e]:s}))},y=async e=>{try{v(!0),p.A.info("Analizando imagen...");let a=await C(e);i(a),j(!0);let s=new FormData;s.append("file",e);let t=await fetch("/api/upload",{method:"POST",body:s});if(!t.ok)throw Error("Error al subir imagen");await t.json(),p.A.success("Imagen analizada correctamente"),v(!1)}catch(e){console.error("Error analyzing image:",e),p.A.error("Error al analizar la imagen"),v(!1)}},w=async()=>{if(!e.nombre.trim()){p.A.error("Por favor ingrese el nombre del paciente");return}if(!f||!s){p.A.error("Por favor capture o seleccione una imagen de la lesi\xf3n");return}try{v(!0),p.A.info("Evaluando riesgo...");let a=await fetch("/api/evaluaciones",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...e,...s,cloudStoragePath:null})});if(!a.ok){let e=await a.json();throw Error(e.error||"Error al evaluar")}let t=await a.json();l({riesgo:t.evaluacion.riesgo,nivelRiesgo:t.evaluacion.nivelRiesgo,semaforoColor:t.evaluacion.semaforoColor,evolArea:t.evaluacion.evolArea,evolDesv:t.evaluacion.evolDesv}),p.A.success("Evaluaci\xf3n completada")}catch(e){console.error("Error evaluating:",e),p.A.error(e instanceof Error?e.message:"Error al evaluar")}finally{v(!1)}};return(0,t.jsxs)("div",{className:"space-y-6",children:[n&&(0,t.jsx)(c.E.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"mb-6",children:(0,t.jsx)(E,{riesgo:n.riesgo,nivelRiesgo:n.nivelRiesgo,semaforoColor:n.semaforoColor,nombre:e.nombre})}),(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,t.jsxs)(c.E.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},className:"bg-card rounded-lg border card-shadow p-6",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-6",children:[(0,t.jsx)(d.Z,{className:"w-5 h-5 text-primary"}),(0,t.jsx)("h2",{className:"text-xl font-semibold",children:"Datos del Paciente"})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"input-group",children:[(0,t.jsx)("label",{className:"form-label",children:"Nombre del Paciente"}),(0,t.jsx)("input",{type:"text",placeholder:"Ingrese el nombre completo",value:e.nombre,onChange:e=>N("nombre",e.target.value),className:"form-input"})]}),(0,t.jsxs)("div",{className:"input-group",children:[(0,t.jsxs)("label",{className:"form-label",children:[(0,t.jsx)(m.Z,{className:"w-4 h-4 inline mr-1"}),"Sensibilidad (0-6)"]}),(0,t.jsx)("input",{type:"number",min:"0",max:"6",step:"0.1",value:e.sensibilidad,onChange:e=>N("sensibilidad",parseFloat(e.target.value)||0),className:"form-input"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"0 = Ausente, 6 = Normal"})]}),(0,t.jsxs)("div",{className:"input-group",children:[(0,t.jsxs)("label",{className:"form-label",children:[(0,t.jsx)(x.Z,{className:"w-4 h-4 inline mr-1"}),"Tiempo Evoluci\xf3n [d\xedas]"]}),(0,t.jsx)("input",{type:"number",min:"0",max:"35",value:e.tiempoEvolucion,onChange:e=>N("tiempoEvolucion",parseInt(e.target.value)||0),className:"form-input"})]}),(0,t.jsxs)("div",{className:"input-group",children:[(0,t.jsxs)("label",{className:"form-label",children:[(0,t.jsx)(u.Z,{className:"w-4 h-4 inline mr-1"}),"Control Gluc\xe9mico (5-12)"]}),(0,t.jsx)("input",{type:"number",min:"5",max:"12",step:"0.1",value:e.controlGlucemico,onChange:e=>N("controlGlucemico",parseFloat(e.target.value)||5),className:"form-input"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"HbA1c en porcentaje"})]}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)("input",{type:"checkbox",id:"secrecion",checked:e.secrecion,onChange:e=>N("secrecion",e.target.checked),className:"w-4 h-4 text-primary bg-gray-100 border-gray-300 rounded focus:ring-primary"}),(0,t.jsx)("label",{htmlFor:"secrecion",className:"form-label",children:"\xbfSecreci\xf3n?"})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)("input",{type:"checkbox",id:"eritema",checked:e.eritema,onChange:e=>N("eritema",e.target.checked),className:"w-4 h-4 text-primary bg-gray-100 border-gray-300 rounded focus:ring-primary"}),(0,t.jsx)("label",{htmlFor:"eritema",className:"form-label",children:"\xbfEritema?"})]})]}),s&&(0,t.jsxs)(c.E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"bg-muted/50 rounded-lg p-4 space-y-2",children:[(0,t.jsx)("h3",{className:"font-semibold text-sm",children:"Resultados del An\xe1lisis:"}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"\xc1rea lesi\xf3n:"}),(0,t.jsx)("br",{}),(0,t.jsxs)("span",{className:"font-semibold",children:[s.areaLesion.toFixed(2)," cm\xb2"]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Desv. Est\xe1ndar R:"}),(0,t.jsx)("br",{}),(0,t.jsx)("span",{className:"font-semibold",children:s.desvEstR.toFixed(2)})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Media RGB:"}),(0,t.jsx)("br",{}),(0,t.jsxs)("span",{className:"font-semibold text-xs",children:["R:",s.mediaR.toFixed(0)," G:",s.mediaG.toFixed(0)," B:",s.mediaB.toFixed(0)]})]})]})]})]})]}),(0,t.jsxs)(c.E.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:.1},className:"bg-card rounded-lg border card-shadow p-6",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-6",children:[(0,t.jsx)(h.Z,{className:"w-5 h-5 text-secondary"}),(0,t.jsx)("h2",{className:"text-xl font-semibold",children:"An\xe1lisis de Imagen"})]}),(0,t.jsx)(b,{onImageCapture:y})]})]}),(0,t.jsxs)(c.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"flex flex-col sm:flex-row gap-3 justify-center pt-6 border-t",children:[(0,t.jsxs)("button",{onClick:w,disabled:o||!f||!e.nombre.trim(),className:"btn-primary flex items-center justify-center gap-2 px-8 py-3 text-lg disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,t.jsx)(g.Z,{className:"w-5 h-5"}),o?"Evaluando...":"Evaluar Riesgo"]}),(0,t.jsxs)("button",{onClick:()=>{a({nombre:"",sensibilidad:0,tiempoEvolucion:0,controlGlucemico:5,secrecion:!1,eritema:!1}),i(null),l(null),j(!1),p.A.info("Formulario limpiado")},disabled:o,className:"btn-secondary flex items-center justify-center gap-2 px-8 py-3 text-lg",children:[(0,t.jsx)(h.Z,{className:"w-5 h-5"}),"Limpiar Formulario"]})]})]})}var R=s(5012),A=s(4670),D=s(8967),k=s(6584),P=s(6317);s(6308);let z=async e=>{try{let a=new P.ZP("p","mm","a4"),s=a.internal.pageSize.getWidth(),t=a.internal.pageSize.getHeight();a.setFillColor(41,128,185),a.rect(0,0,s,40,"F"),a.setTextColor(255,255,255),a.setFontSize(18),a.setFont("helvetica","bold"),a.text("COLEGIO M\xc9XICO",20,15),a.setFontSize(12),a.text("Sistema de Evaluaci\xf3n de Pie Diab\xe9tico",20,25),a.text("An\xe1lisis inteligente con l\xf3gica difusa",20,32),a.setFontSize(10);let r=new Date(e.fechaHora).toLocaleDateString("es-MX",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"});a.text(`Fecha: ${r}`,s-60,15);let i=55;a.setTextColor(0,0,0),a.setFontSize(16),a.setFont("helvetica","bold"),a.text("REPORTE M\xc9DICO",20,i),i+=15,a.setFontSize(12),a.setFont("helvetica","normal"),a.text(`Paciente: ${e.paciente.nombre}`,20,i),a.text(`ID Evaluaci\xf3n: ${e.id}`,s-60,i),i+=20,a.setFont("helvetica","bold"),a.text("PAR\xc1METROS CL\xcdNICOS",20,i),i+=10,a.setFont("helvetica","normal"),a.setFontSize(11),[["Sensibilidad:",`${e.sensibilidad}/6`],["Tiempo Evoluci\xf3n:",`${e.tiempoEvolucion} d\xedas`],["Control Gluc\xe9mico:",`${e.controlGlucemico}`],["Secreci\xf3n:",e.secrecion?"S\xed":"No"],["Eritema:",e.eritema?"S\xed":"No"]].forEach(([e,s])=>{a.text(e,20,i),a.text(s,80,i),i+=6}),i+=10,a.setFont("helvetica","bold"),a.setFontSize(12),a.text("AN\xc1LISIS DE IMAGEN",20,i),i+=10,a.setFont("helvetica","normal"),a.setFontSize(11),[["\xc1rea de lesi\xf3n:",`${e.areaLesion.toFixed(2)} px\xb2`],["Desviaci\xf3n est\xe1ndar R:",`${e.desvEstR.toFixed(2)}`],["Media RGB:",`R:${e.mediaR.toFixed(1)} G:${e.mediaG.toFixed(1)} B:${e.mediaB.toFixed(1)}`],["Evoluci\xf3n \xe1rea:",e.evolArea||"N/A"],["Evoluci\xf3n desv:",e.evolDesv||"N/A"]].forEach(([e,s])=>{a.text(e,20,i),a.text(s,80,i),i+=6}),i+=20,a.setFont("helvetica","bold"),a.setFontSize(14),a.text("EVALUACI\xd3N DE RIESGO",20,i),i+=15;let n={verde:[34,139,34],amarillo:[255,193,7],rojo:[220,20,60]}[e.semaforoColor]||[128,128,128];a.setFillColor(n[0],n[1],n[2]),a.circle(30,i+5,8,"F"),a.setFont("helvetica","bold"),a.setFontSize(16),a.text(`RIESGO: ${e.nivelRiesgo.toUpperCase()}`,50,i+8),i+=10,a.setFontSize(12),a.setFont("helvetica","normal"),a.text(`Valor num\xe9rico: ${e.riesgo.toFixed(2)}`,50,i+8),i+=25,a.setFont("helvetica","bold"),a.setFontSize(12),a.text("RECOMENDACIONES CL\xcdNICAS",20,i),i+=10,a.setFont("helvetica","normal"),a.setFontSize(11);let l=[];switch(e.semaforoColor){case"verde":l=["• Continuar con cuidados preventivos regulares","• Mantener control gluc\xe9mico actual","• Revisi\xf3n en 3-6 meses","• Educaci\xf3n en autocuidado de pies"];break;case"amarillo":l=["• Vigilancia estrecha cada 2-4 semanas","• Optimizar control gluc\xe9mico","• Evaluaci\xf3n vascular si es necesario","• Considerar interconsulta con especialista","• Reforzar educaci\xf3n en cuidado de pies"];break;case"rojo":l=["• ATENCI\xd3N URGENTE REQUERIDA","• Interconsulta inmediata con especialista","• Control gluc\xe9mico estricto","• Evaluaci\xf3n vascular completa","• Posible hospitalizaci\xf3n","• Seguimiento semanal"]}l.forEach(e=>{i>t-30&&(a.addPage(),i=20),a.text(e,20,i),i+=6}),(i+=15)>t-50&&(a.addPage(),i=20),a.setDrawColor(200,200,200),a.line(20,i,s-20,i),i+=10,a.setFontSize(10),a.setTextColor(100,100,100),a.text("Este reporte fue generado autom\xe1ticamente por el Sistema de Evaluaci\xf3n de Pie Diab\xe9tico",20,i),a.text("Colegio M\xe9xico - Instituci\xf3n Colaboradora",20,i+6),a.text(`Generado el: ${new Date().toLocaleDateString("es-MX")}`,20,i+12);let o=new Date().toISOString().replace(/[:.]/g,"-").split("T")[0],c=`Reporte_Medico_${e.paciente.nombre.replace(/\s+/g,"_")}_${o}.pdf`,d=a.output("blob"),m=window.URL.createObjectURL(d),x=document.createElement("a");return x.href=m,x.download=c,x.style.display="none",document.body.appendChild(x),x.click(),document.body.removeChild(x),window.URL.revokeObjectURL(m),{success:!0,fileName:c}}catch(e){throw console.error("Error generating PDF:",e),Error("Error al generar el PDF")}};function I(){let[e,a]=(0,r.useState)([]),[s,i]=(0,r.useState)(!0),[n,l]=(0,r.useState)("");(0,r.useEffect)(()=>{o()},[]);let o=async()=>{try{i(!0);let e=await fetch("/api/evaluaciones");if(!e.ok)throw Error("Error al cargar historial");let s=await e.json();a(s.evaluaciones||[])}catch(e){console.error("Error loading historial:",e),p.A.error("Error al cargar el historial")}finally{i(!1)}},m=e.filter(e=>e.paciente.nombre.toLowerCase().includes(n.toLowerCase())),x=e=>new Date(e).toLocaleString("es-ES",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),u=async e=>{try{p.A.info("Generando PDF m\xe9dico...");let a={...e,paciente:{nombre:e.paciente.nombre},evolArea:e.evolArea||"",evolDesv:e.evolDesv||""};await z(a),p.A.success("PDF generado exitosamente")}catch(e){console.error("Error generating PDF:",e),p.A.error("Error al generar el PDF m\xe9dico")}};return s?(0,t.jsxs)("div",{className:"flex items-center justify-center py-12",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"}),(0,t.jsx)("span",{className:"ml-2",children:"Cargando historial..."})]}):(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(R.Z,{className:"w-6 h-6 text-primary"}),(0,t.jsx)("h2",{className:"text-2xl font-bold",children:"Historial de Evaluaciones"})]}),(0,t.jsx)("div",{className:"flex gap-2",children:(0,t.jsx)("input",{type:"text",placeholder:"Buscar por nombre de paciente...",value:n,onChange:e=>l(e.target.value),className:"form-input max-w-xs"})})]}),0===m.length?(0,t.jsxs)("div",{className:"text-center py-12 bg-card rounded-lg border",children:[(0,t.jsx)(h.Z,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),(0,t.jsx)("h3",{className:"text-lg font-medium mb-2",children:"No hay evaluaciones"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:n?"No se encontraron evaluaciones que coincidan con la b\xfasqueda":"A\xfan no hay evaluaciones registradas en el sistema"})]}):(0,t.jsx)("div",{className:"grid gap-4",children:m.map((e,a)=>(0,t.jsx)(c.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*a},className:"bg-card rounded-lg border card-shadow p-6",children:(0,t.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center gap-4",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,t.jsx)(d.Z,{className:"w-4 h-4 text-primary"}),(0,t.jsx)("h3",{className:"text-lg font-semibold",children:e.paciente.nombre})]}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground mb-3",children:x(e.fechaHora)}),(0,t.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 text-sm",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Sensibilidad:"}),(0,t.jsx)("br",{}),(0,t.jsx)("span",{className:"font-medium",children:e.sensibilidad})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"\xc1rea lesi\xf3n:"}),(0,t.jsx)("br",{}),(0,t.jsxs)("span",{className:"font-medium",children:[e.areaLesion.toFixed(2)," cm\xb2"]}),e.evolArea&&(0,t.jsxs)("div",{className:`text-xs flex items-center gap-1 mt-1 ${e.evolArea.includes("+")?"text-red-600":"text-green-600"}`,children:[e.evolArea.includes("+")?(0,t.jsx)(A.Z,{className:"w-3 h-3"}):(0,t.jsx)(D.Z,{className:"w-3 h-3"}),e.evolArea]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Desv. R:"}),(0,t.jsx)("br",{}),(0,t.jsx)("span",{className:"font-medium",children:e.desvEstR.toFixed(2)}),e.evolDesv&&(0,t.jsxs)("div",{className:`text-xs flex items-center gap-1 mt-1 ${e.evolDesv.includes("+")?"text-red-600":"text-green-600"}`,children:[e.evolDesv.includes("+")?(0,t.jsx)(A.Z,{className:"w-3 h-3"}):(0,t.jsx)(D.Z,{className:"w-3 h-3"}),e.evolDesv]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Control Gluc:"}),(0,t.jsx)("br",{}),(0,t.jsxs)("span",{className:"font-medium",children:[e.controlGlucemico,"%"]})]})]})]}),(0,t.jsxs)("div",{className:"lg:w-72 space-y-3",children:[(0,t.jsx)(E,{riesgo:e.riesgo,nivelRiesgo:e.nivelRiesgo,semaforoColor:e.semaforoColor,className:"text-sm"}),(0,t.jsxs)("button",{onClick:()=>u(e),className:"w-full flex items-center justify-center gap-2 px-3 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md text-sm font-medium transition-colors",children:[(0,t.jsx)(k.Z,{className:"w-4 h-4"}),"Generar PDF"]})]})]})},e.id))})]})}var Z=s(4624),L=s(5076);function $(){let[e,a]=(0,r.useState)([]),[s,i]=(0,r.useState)(!0),[n,l]=(0,r.useState)("");(0,r.useEffect)(()=>{o()},[]);let o=async()=>{try{i(!0);let e=await fetch("/api/pacientes");if(!e.ok)throw Error("Error al cargar pacientes");let s=await e.json();a(s.pacientes||[])}catch(e){console.error("Error loading pacientes:",e),p.A.error("Error al cargar los pacientes")}finally{i(!1)}},d=e.filter(e=>e.nombre.toLowerCase().includes(n.toLowerCase())),x=e=>new Date(e).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"}),u=(e,a)=>{let s="px-2 py-1 rounded-full text-xs font-medium";switch(a){case"verde":return`${s} bg-green-100 text-green-800`;case"amarillo":return`${s} bg-yellow-100 text-yellow-800`;case"rojo":return`${s} bg-red-100 text-red-800`;default:return`${s} bg-gray-100 text-gray-800`}};return s?(0,t.jsxs)("div",{className:"flex items-center justify-center py-12",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"}),(0,t.jsx)("span",{className:"ml-2",children:"Cargando pacientes..."})]}):(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(Z.Z,{className:"w-6 h-6 text-primary"}),(0,t.jsx)("h2",{className:"text-2xl font-bold",children:"Pacientes"}),(0,t.jsxs)("span",{className:"text-sm text-muted-foreground",children:["(",d.length," ",1===d.length?"paciente":"pacientes",")"]})]}),(0,t.jsx)("div",{className:"flex gap-2",children:(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(L.Z,{className:"absolute left-3 top-1/2 transform -y-1/2 w-4 h-4 text-muted-foreground"}),(0,t.jsx)("input",{type:"text",placeholder:"Buscar paciente...",value:n,onChange:e=>l(e.target.value),className:"form-input pl-9 max-w-xs"})]})})]}),0===d.length?(0,t.jsxs)("div",{className:"text-center py-12 bg-card rounded-lg border",children:[(0,t.jsx)(Z.Z,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),(0,t.jsx)("h3",{className:"text-lg font-medium mb-2",children:"No hay pacientes"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:n?"No se encontraron pacientes que coincidan con la b\xfasqueda":"A\xfan no hay pacientes registrados en el sistema"})]}):(0,t.jsx)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:d.map((e,a)=>{let s=e.evaluaciones[0];return(0,t.jsxs)(c.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*a},className:"bg-card rounded-lg border card-shadow p-6 hover:shadow-lg transition-shadow",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"font-semibold text-lg mb-1",children:e.nombre}),(0,t.jsxs)("p",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[(0,t.jsx)(R.Z,{className:"w-3 h-3"}),"Registrado: ",x(e.fechaCreacion)]})]}),s&&(0,t.jsx)("span",{className:u(s.nivelRiesgo,s.semaforoColor),children:s.nivelRiesgo})]}),s?(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[(0,t.jsx)(m.Z,{className:"w-4 h-4"}),"\xdaltima evaluaci\xf3n: ",x(s.fechaHora)]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Riesgo:"}),(0,t.jsx)("div",{className:"font-semibold",children:s.riesgo.toFixed(2)})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"\xc1rea:"}),(0,t.jsxs)("div",{className:"font-semibold",children:[s.areaLesion.toFixed(2)," cm\xb2"]})]})]}),(0,t.jsxs)("div",{className:"text-xs text-muted-foreground pt-2 border-t",children:["Total evaluaciones: ",e.evaluaciones.length]})]}):(0,t.jsx)("div",{className:"text-center py-4",children:(0,t.jsx)("p",{className:"text-muted-foreground text-sm",children:"Sin evaluaciones registradas"})})]},e.id)})})]})}function M(){let[e,a]=(0,r.useState)("evaluacion");return(0,t.jsxs)("div",{className:"min-h-screen bg-background",children:[(0,t.jsx)(o,{activeTab:e,onTabChange:a}),(0,t.jsxs)("main",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:["evaluacion"===e&&(0,t.jsx)(S,{}),"historial"===e&&(0,t.jsx)(I,{}),"pacientes"===e&&(0,t.jsx)($,{})]})]})}}},function(e){e.O(0,[240,302,64,585,958,386,156,744],function(){return e(e.s=5656)}),_N_E=e.O()}]);