"use strict";(()=>{var e={};e.id=896,e.ids=[896],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},5315:e=>{e.exports=require("path")},396:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>f,patchFetch:()=>x,requestAsyncStorage:()=>h,routeModule:()=>m,serverHooks:()=>v,staticGenerationAsyncStorage:()=>g});var i={};r.r(i),r.d(i,{POST:()=>d,dynamic:()=>p});var a=r(9182),n=r(2007),o=r(6719),s=r(3442),l=r(5970);let c=require("fs");var u=r(5315);let p="force-dynamic";async function d(e){try{let e=u.join(process.cwd(),"public","resultados_pacientes.csv");if(!c.existsSync(e))return s.NextResponse.json({error:"Archivo CSV no encontrado"},{status:404});let t=c.readFileSync(e,"utf-8").trim().split("\n");if(t.length<2)return s.NextResponse.json({error:"Archivo CSV vac\xedo o inv\xe1lido"},{status:400});let r=t[0].split(",").map(e=>e.trim()),i=[],a=[];for(let e=1;e<t.length;e++)try{let a=t[e].split(",");if(a.length<r.length)continue;let n={};if(r.forEach((e,t)=>{n[e]=a[t]?.trim()||null}),n.Comparacion&&"actual"!==n.Comparacion||!n.Paciente||!n.FechaHora)continue;let o=await l._.paciente.findFirst({where:{nombre:n.Paciente}});o||(o=await l._.paciente.create({data:{nombre:n.Paciente}}));let s=(e,t=0)=>!e||""===e||isNaN(Number(e))?t:Number(e),c=e=>!!e&&""!==e&&s(e)>0,u=s(n.Riesgo,2),p="MODERADO",d="amarillo";u<1.6?(p="BAJO",d="verde"):u>=2.1&&(p="ALTO",d="rojo");let m=await l._.evaluacion.create({data:{pacienteId:o.id,fechaHora:new Date(n.FechaHora),sensibilidad:s(n.Sensibilidad,0),tiempoEvolucion:Math.round(s(n.TiempoEvol,0)),controlGlucemico:s(n.ControlGlu,7),secrecion:c(n.Secrecion),eritema:c(n.Eritema),areaLesion:s(n.AreaLesion,0),desvEstR:s(n.DesvEstR,0),mediaR:s(n.MediaR,0),mediaG:s(n.MediaG,0),mediaB:s(n.MediaB,0),cloudStoragePath:null,riesgo:u,nivelRiesgo:p,semaforoColor:d,evolArea:n.EvolArea||null,evolDesv:n.EvolDesv||null}});i.push({paciente:o.nombre,evaluacionId:m.id,fecha:m.fechaHora})}catch(t){a.push({linea:e+1,error:t instanceof Error?t.message:String(t)})}return s.NextResponse.json({success:!0,migrados:i.length,errores:a.length,detalles:{migrados:i,errores:a.slice(0,10)}})}catch(e){return console.error("Error migrating CSV:",e),s.NextResponse.json({error:"Error interno durante migraci\xf3n"},{status:500})}}let m=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/migrate/route",pathname:"/api/migrate",filename:"route",bundlePath:"app/api/migrate/route"},resolvedPagePath:"/home/ubuntu/sistema_pie_diabetico/app/app/api/migrate/route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:h,staticGenerationAsyncStorage:g,serverHooks:v}=m,f="/api/migrate/route";function x(){return(0,o.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:g})}},5970:(e,t,r)=>{r.d(t,{_:()=>n});let i=require("@prisma/client");class a{getClient(){return this.client||(this.client=new i.PrismaClient({log:["error"]})),this.client}constructor(){this.client=null}}let n=new a().getClient()}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[372,609],()=>r(396));module.exports=i})();